{% extends "calisphere/searchResults.html" %}
{% load calisphere-extras %}
{% load staticfiles %}
{% load humanize %}

{% block title %}: {{ collection.name }}{% endblock %}
{% block page-metadata %}
{% include "calisphere/microdata.html" with title=collection.name description=collection.description %}
{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block pageTitle %}
  <nav class="breadcrumb--style1" aria-label="breadcrumb navigation">
    <ul>
      <li>
        <a href="{% url 'calisphere:collectionsDirectory' %}" data-pjax="js-pageContent">Collections</a>
      </li>
    </ul>
  </nav>

  <h1 id="js-collection" data-collection="{{ collection_id }}" data-referralName="{{ collection.name }}">
    {{ collection.name }}
  </h1>
{% endblock %}

{% block additionalInfo %}
<div class="collection-intro" data-ga-dim1="{{ collection.local_id }}{{ collection.slug }}">
  <div class="col-md-3">
    <div class="collection-intro__institution">
      <h2 class="collection-intro__institution-heading">Owning Institution{{ collection.repository|pluralize }}:
        {% for repository in collection.repository %}
          {% if 'campus' in repository and repository.campus.0.name %}
            <a
              href="{% url 'calisphere:campusView' repository.campus.0.slug 'collections' %}"
              class="collection-intro__institution-heading-link"
              data-pjax="js-pageContent"
            >{{ repository.campus.0.name }}</a>,
          {% endif %}
          <a
            href="{% url 'calisphere:repositoryView' repository.resource_id 'collections' %}"
            class="collection-intro__institution-heading-link"
            data-pjax="js-pageContent"
            data-ga-code="{{ repository.google_analytics_tracking_code }}"
            data-ga-dim2="{%if 'campus' in repository and repository.campus.0.name %}{{ repository.campus.0.slug }}-{% endif %}{{ repository.slug }}"
          >
            {{ repository.name }}
          </a>
          {% if forloop.counter < collection.repository|length %} and {% endif %}
        {% endfor %}
        <br/><br/>
        {% if collection.repository|length > 1 %}
          {% for repository in collection.repository %}
            <a class="btn btn-default button__back-to-institution" href="{% url 'calisphere:repositoryView' repository.resource_id 'collections' %}" data-pjax="js-pageContent">
              <span class="fa fa-angle-left fa-lg fa-fw"></span>
              Go to {{ repository.name }} Page
            </a>
          {% endfor %}
          {% else %}
          {% with collection.repository.0 as repository %}
            <a class="btn btn-default button__back-to-institution" href="{% url 'calisphere:repositoryView' repository.resource_id 'collections' %}" data-pjax="js-pageContent">
              <span class="fa fa-angle-left fa-lg fa-fw"></span>
              Go to Institution Page
            </a>
          {% endwith %}
        {% endif %}
      </h2>
    </div>
  </div>

  <div class="col-md-9">
    <div class="collection-intro__about">
      {% if 'description' in collection %}
      <h3 class="collection-intro__about-heading">About this Collection</h3>
        <span class="collection-intro__about-description">
          {{ collection.description|urlize }}
        </span>
      {% endif %}
      {% if collection.url_local|length > 0 %}
        <a class="collection-intro__about-link" href="{{ collection.url_local }}" target="_blank">View this collection on the contributor's website.</a><br/>
      {% endif %}
      {% if collection.url_oac|length > 0 %}
        <a class="collection-intro__about-link" href="{{ collection.url_oac }}" target="_blank">View collection guide.</a>
      {% endif %}
      <label for="{{ collection_id }}" aria-hidden="true" class="display-none">Current Collection ID</label>
      <input id="{{ collection_id }}" class="facet js-facet facet-collection_data display-none" form="js-facet" type="checkbox" name="collection_data" value="{{ collection_id }}" checked aria-hidden="true">

    </div>
  </div>

</div>
{% endblock %}

{% block sidebar %}
<div class="row">
<!--   <div class="col-sm-6 col-md-12">
    <div class="button__institution-tabs-container">
      <a class="button__institution-tab-collections--selected"
      href="{% url 'calisphere:collectionBrowse' collection_id %}" data-pjax="js-pageContent">
        Browse collection
      </a>
      <a class="button__institution-tab-search" href="{% url 'calisphere:collectionView' collection_id %}" data-pjax="js-pageContent">
        Search this collection
      </a>
    </div>
  </div>
 -->  
 <div class="col-sm-6 col-md-12">

  </div>
  <div class="col-sm-6 col-md-12">
    {% include "calisphere/collections/collectionSnapshot.html" %}
  </div>
</div>
{% endblock %}

{% block filters %}{% endblock %}

{% block mainContent %}
  <div style="display:flex">
    <div style="flex: 1 1 auto"><h2 class="text__institution-heading2">Browse Collection | <a href="{% url 'calisphere:collectionView' collection_id %}">View all items</h2></a></div>
    <div style="flex: 1 1 auto;">
      <div style="float: right">
        <form class="global-search" role="search" id="js-collectionSearch" action="{% url 'calisphere:collectionView' collection_id %}" method="get">
            <label class="sr-only" for="header__search-field">Search this collection</label>
            <div class="input-group">
              <input id="header__search-field" form="js-collectionSearch" name="q" value="" type="search" class="form-control global-search__field js-collectionSearch" placeholder="Search this collection">
              <span class="input-group-btn">
                <button class="btn btn-default global-search__button" type="submit" aria-label="search">
                  <span class="fa fa-search"></span>
                </button>
              </span>
            </div>
          </form>
      </div>
    </div>
  </div>

  <div class="collection-cluster-form">
  <form id="js-collectionFacetForm" action="{{ form_action }}">
    {% if view_format == 'grid' %}
    <button id="grid" class="btn btn-link js-view_format-toggle">
      <span class="fa fa-th-large"></span> Grid
    </button>
    <button id="list" class="btn btn-link thumblist-toggle__list js-view_format-toggle">
      <span class="fa fa-th-list"></span> List
    </button>
    {% else %}
    <button id="grid" class="btn btn-link thumblist-toggle__thumbnails js-view_format-toggle">
      <span class="fa fa-th-large"></span> Grid
    </button>
    <button id="list" class="btn btn-link js-view_format-toggle">
      <span class="fa fa-th-list"></span> List
    </button>
    {% endif %}
    <input type="hidden" name="view_format" value="{{ view_format }}">

    <select name="sort" id="js-sort-selector" class="collection-cluster-form__sort-selector">
      <option {% if sort == "largestFirst" %}selected{% endif %} value="largestFirst">
        Largest item count first
      </option>
      <option {% if sort == "smallestFirst" %}selected{% endif %} value="smallestFirst">
        Smallest item count first
      </option>
      <option {% if sort == "az" %}selected{% endif %} value="az">
        A-Z
      </option>
      <option {% if sort == "za" %}selected{% endif %} value="za">
        Z-A
      </option>
    </select>

    {% if view_format == 'grid' %}
      Viewing {{ page_info.start }} - {% if page_info.end < unique %}{{ page_info.end }}{% else %}{{ unique }}{% endif %} of {{ unique|intcomma }}
      {% if page_info.start > 1 %}
        <a class="btn btn-link pag-dropdown__arrow-icon"
          aria-label="previous set"
          href="{{ request.path }}?view_format={{ view_format }}&sort={{ sort }}&page={{ page_info.page|subtract:1 }}" data-pjax="js-pageContent">
            <span class="fa fa-caret-left fa-lg">
        </a>
      {% else %}
        <button class="btn btn-link pag-dropdown__arrow-icon"
          type="button" aria-label="previous set" disabled>
            <span class="fa fa-caret-left fa-lg"></span>
        </button>
      {% endif %}
      {% if page_info.end < unique %}
        <a class="btn btn-link pag-dropdown__arrow-icon"
          aria-label="next set"
          href="{{ request.path }}?view_format={{ view_format }}&sort={{ sort }}&page={{ page_info.page|add:1 }}" data-pjax="js-pageContent">
            <span class="fa fa-caret-right fa-lg">
        </a>
      {% else %}
        <button class="btn btn-link pag-dropdown__arrow-icon"
          type="button" aria-label="next set" disabled>
            <span class="fa fa-caret-right fa-lg"></span>
        </button>
      {% endif %}


    {% endif %}
  </form>
</div>


  <div class="explore-clusters-carousel">
    {% for cluster in clusters %}
    <div class="row explore-clusters">
      <div class="col-md-12 cluster-listing">
        <h3>{{ cluster.unique|intcomma }} {{ cluster.facet_field.display|title }}{% if cluster.facet_field.display != 'rights' %}s{% endif %} in this Collection</h3>

        {% if cluster.unique > 3 %}
        <div class="row">
        <div class="col-md-5">
          <h4 class="sr-only">Search for a {{cluster.facet_field.display}}</h4>
          <form class="clustersearch__form-{{cluster.facet_field.facet}}" role="search" onsubmit="false()">
            <label for="clustersearch__field-{{cluster.facet_field.facet}}" class="sr-only">
              Search for a {{cluster.facet_field.display}}
            </label>
            <div class="input-group">
              <input id="clustersearch__field-{{cluster.facet_field.facet}}" type="search" placeholder="Search for a {{cluster.facet_field.display}}" class="form-control">
                <span class="input-group-btn">
                  <button class="btn btn-default global-search__button" type="submit" aria-label="search"><span class="fa fa-search"></span>
                  </button>
                </span>
              </input>
            </div>
          </form>
        </div>
        </div>
        {% endif %}

        <ol>
          {% for value in cluster.values %}
            {# if forloop.counter0 < 5 #}
            <li>
              <a href="{{ value.uri }}?view_format=list" data-pjax="js-pageContent">{{ value.label }} ({{ value.count|intcomma }} items)</a>
            </li>
            {# endif #}
          {% endfor %}
        </ol>

      </div>
      <a href="{{cluster.values.0.uri}}" data-pjax="js-pageContent">
      </a>
    </div>
    {% endfor %}
  </div>

  <script>
  var cluster_fields = [];
  {% for cluster in clusters %}
  {% if cluster.unique > 1 %}
  cluster_fields.push('{{ cluster.facet_field.facet }}');
  {% endif %}
  {% endfor %}

  var clusters = {
    'collection_id': {{collection_id}},
    'clusters': cluster_fields
  };
  </script>
{% endblock %}